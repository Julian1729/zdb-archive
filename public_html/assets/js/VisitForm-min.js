var Activity=function(){function e(e){try{var t=new DOMParser;return doc=t.parseFromString(e,"text/html"),doc.body.firstChild}catch(t){var r=document.createElement("DIV");return r.innerHTML=e,r.firstElementChild}}function t(e){function t(){n.classList.add("hide"),o.classList.remove("hide")}function r(){o&&o.classList.add("hide"),n.classList.remove("hide")}function i(){e.remove()}var n=e.querySelector(".publisher-form"),o=e.querySelector(".shepherding-form"),a=e.querySelector('input[value="1"]');return a&&(a.onclick=function(){this.checked&&t()}),e.querySelector('input[value="2"]').onclick=function(){this.checked&&r()},e.querySelector('input[value="3"]').onclick=function(){this.checked&&r()},e.querySelector(".delete-row").onclick=i,e}function r(r){var i=null;if("bro"===r)i=u.brother_activity;else{if("sis"!==r)throw new Error("Invalid person param");i=u.sister_activity}var n={counter:[],rid:function(){var e="r"+v.uid;return this.counter.push(e),v.uid++,e},lid:function(){return this.counter.shift()},name:r+"_radiogroup_"+v[r]++};return t(e(Mustache.to_html(i,n)))}function i(e){var t=null;if("object"==typeof e)try{t=e.target.getAttribute("data-group")}catch(e){throw new Error("No data group defined for target")}else{if("string"!=typeof e)throw new Error("Invalid data-group");t=e}n(t,r(t.split("_")[2]))}function n(e,t){var r=u.activity_containers[e];if(!r)throw new Error("No container found for data-group "+e);r.appendChild(t,r)}function o(e,t){var r=t.type,i=null;for(var n in l)if(l.hasOwnProperty(n)&&l[n]===r){i=n;break}if(!i)throw new Error("No value found for activity type");return e.querySelector('input[value="'+i+'"]').checked=!0,"sheperding_call"===r?(e.querySelector('input[name="shep_elder"]').value=t.elder,e.querySelector('input[name="shep_publisher"]').value=t.publisher,e.querySelector('textarea[name="shep_situation"]').value=t.situation,e.querySelector(".shepherding-form").classList.remove("hide")):"bible_study"!==r&&"return_visit"!==r||(e.querySelector('input[name="pub_name"]').value=t.publisher,e.querySelector(".publisher-form").classList.remove("hide")),e}function a(){var e={};for(var t in u.activity_containers){var r=[];if(u.activity_containers.hasOwnProperty(t)){for(var i=u.activity_containers[t],n=i.querySelectorAll(".activity"),o=0;o<n.length;o++){var a=n[o],l=c(a,!0);l&&r.push(l)}e[t]=r}}return e}function c(e,t){t=t||!1;var r={},i=e.querySelector('.radiogroup input[type="radio"]:checked');if(!i){if(t)for(var n=e.querySelectorAll(".radiobutton-container"),o=0;o<n;o++)n[o].classList.add("fail");else console.error("No selection inside radiogroup");return null}if(r.type=l[i.value],!r.type)return null;if("sheperding_call"===r.type){var a={elder:e.querySelector('input[name="shep_elder"]'),publisher:e.querySelector('input[name="shep_publisher"]'),situation:e.querySelector('textarea[name="shep_situation"]')};for(var o in a)if(a.hasOwnProperty(o)){var c=a[o];c.value?r[o]=c.value:!0===t&&c.classList.add("fail")}}else if("bible_study"===r.type||"return_visit"===r.type){var u=e.querySelector('input[name="pub_name"]');u.value?r.publisher=u.value:!0===t&&u.classList.add("fail")}return r}for(var u={brother_activity:document.getElementById("brother-activity").innerHTML,sister_activity:document.getElementById("sister-activity").innerHTML,activity_buttons:document.querySelectorAll(".add-activity-button"),activity_containers:function(){for(var e={},t=document.querySelectorAll(".activity-container"),r=0;r<t.length;r++){var i=t[r],n=i.getAttribute("data-group");if(!n)throw new Error("No data group defined for activity container");e[n]=i}return e}()},l={1:"sheperding_call",2:"bible_study",3:"return_visit"},s=0;s<u.activity_buttons.length;s++){u.activity_buttons[s].onclick=i}var v={bro:0,sis:0,uid:0};return{createActivity:r,injectActivity:n,injectActivityInfo:o,getInfoObject:a}}();!function(){function e(e){if("form1"===e.getAttribute("id")){var t=Activity.getInfoObject();e.querySelector("#activity-data-holder").value=JSON.stringify(t)}var r=parseInt(e.getAttribute("data-order")),n=i[r+1];n&&(a.left(e),a.center(n.element))}function t(e,t){var r=!1;3===parseInt(e.getAttribute("data-order"))&&(r=!0);var i=JSON.parse(t);switch(i.code){case 1:r&&showModal("submit-success-modal");break;case 0:r?Dropper("Please correct the errors in the form below","negative"):Dropper("Please correct the errors in the previous form","negative"),formvalErrorHandler(e,i.errors);break;case 3:Dropper("No changes saved","neutral"),i.errors&&(Dropper("Please correct the errors in the last form","negative"),formvalErrorHandler(e,i.errors));break}}function r(e){var t=parseInt(e.target.getAttribute("for")),r=i[t-1].element;a.right(i[t].element),a.center(r)}var i={1:{element:document.getElementById("form1"),name:"serviceform"},2:{element:document.getElementById("form2"),name:"mealform"},3:{element:document.getElementById("form3"),name:"elderform"}},n={url:URI.AJAX_URI,method:"POST"};for(var o in i)i.hasOwnProperty(o)&&(i[o].formval=function(){var r=F(i[o].element,t,n);return r.extras({action:"visitForm",form:i[o].name}),r.submitButtonClick(e),r}());for(var a={left:function(e){e.classList.add("left"),setTimeout(function(){e.classList.add("hide")},500)},center:function(e){e.classList.remove("hide"),setTimeout(function(){e.classList.remove("left"),e.classList.remove("right")},500)},right:function(e){e.classList.add("right"),setTimeout(function(){e.classList.add("hide")},500)}},c=document.querySelectorAll('button[data-action="back"]'),u=0;u<c.length;u++){c[u].onclick=r}document.getElementById("modal-done-button").onclick=function(){window.location.href=URI.BASE_URI}}(),function(){var e={};for(var t in visitObj)if(visitObj.hasOwnProperty(t)&&""!==visitObj[t]){var r=columnMap[t];e[r]=visitObj[t]}for(var r in e)if(e.hasOwnProperty(r)){var i=document.querySelectorAll('[name="'+r+'"]');if(i.length>=1){console.log("ran");for(var n=0;n<i.length;n++){var o=i[n];"radio"===o.getAttribute("type")?o.value===e[r]&&(o.checked=!0):o.value=e[r]}}}var a=JSON.parse(e.activities);for(var c in a)if(a.hasOwnProperty(c))for(var u=a[c],l=c.split("_")[2],s=0;s<u.length;s++){var v=Activity.createActivity(l),v=Activity.injectActivityInfo(v,u[s]);Activity.injectActivity(c,v)}}();